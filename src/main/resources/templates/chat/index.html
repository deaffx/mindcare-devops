<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pt-BR">
<head th:replace="~{fragments/head :: head('Chat com MindBot')}"></head>
<body>
    <nav th:replace="~{fragments/header :: navbar}"></nav>

    <main class="main-content">
        <div class="container">
            <h1 th:text="#{chat.titulo}">Converse com o MindBot</h1>
            
            <div class="card card-no-hover">
                <div id="chat-messages" style="height: 400px; overflow-y: auto; padding: 1rem; border: 1px solid #e0e0e0; border-radius: 8px; margin-bottom: 1rem; background: #f9f9f9;">
                    <div th:if="${#lists.isEmpty(mensagens)}" class="empty-state" style="text-align: center; color: #666; padding: 2rem;">
                        <p th:utext="#{chat.saudacao}">Ol√°! Sou o MindBot ü§ñ<br>Como posso ajud√°-lo hoje?</p>
                    </div>
                    
                    <div th:each="msg : ${mensagens}" style="margin-bottom: 1rem;">
                        <div th:if="${msg.tipo.name() == 'USUARIO'}" style="text-align: right;">
                            <div style="display: inline-block; background: #2196F3; color: white; padding: 0.8rem 1rem; border-radius: 12px; max-width: 70%; text-align: left;">
                                <p th:text="${msg.conteudo}" style="margin: 0; word-wrap: break-word;"></p>
                                <small th:text="${#temporals.format(msg.criadoEm, 'HH:mm')}" style="opacity: 0.8; font-size: 0.75em;"></small>
                            </div>
                        </div>
                        
                        <div th:if="${msg.tipo.name() == 'CHAT'}" style="text-align: left;">
                            <div style="display: inline-block; background: white; border: 1px solid #e0e0e0; padding: 0.8rem 1rem; border-radius: 12px; max-width: 70%; text-align: left;">
                                <p th:text="${msg.conteudo}" style="margin: 0; word-wrap: break-word;"></p>
                                <small th:text="${#temporals.format(msg.criadoEm, 'HH:mm')}" style="opacity: 0.6; font-size: 0.75em; color: #666;"></small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <form th:action="@{/chat}" method="post" id="chatForm">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <div class="form-group" style="margin-bottom: 0;">
                        <textarea id="mensagem" name="mensagem" required class="form-control" rows="3" 
                                  th:placeholder="#{chat.placeholder}"></textarea>
                    </div>
                    
                    <div class="form-actions" style="margin-top: 1rem;">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i> <span th:text="#{chat.enviar}">Enviar</span>
                        </button>
                    </div>
                </form>
            </div>
            
            <script>
                // Auto scroll para √∫ltima mensagem
                const chatMessages = document.getElementById('chat-messages');
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Limpa textarea ap√≥s enviar
                document.getElementById('chatForm').addEventListener('submit', function() {
                    setTimeout(() => {
                        document.getElementById('mensagem').value = '';
                    }, 100);
                });
            </script>
        </div>
    </main>

    <footer th:replace="~{fragments/footer :: footer}"></footer>
</body>
</html>
