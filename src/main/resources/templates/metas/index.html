<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pt-BR">
<head th:replace="~{fragments/head :: head('Minhas Metas')}"></head>
<body>
    <nav th:replace="~{fragments/header :: navbar}"></nav>

    <main class="main-content">
        <div class="container">
            <div class="metas-header">
                <h1 th:text="#{metas.titulo}">Minhas Metas</h1>
                <a th:href="@{/metas/nova}" class="btn btn-primary">
                    <i class="fas fa-plus"></i> <span th:text="#{metas.nova}">Nova Meta</span>
                </a>
            </div>
            
            <div class="dashboard-grid">
                <div th:each="meta : ${metas.content}" class="card card-metas">
                    <div class="card-header">
                        <i class="fas fa-bullseye"></i>
                        <h3 th:text="${meta.titulo}">Meta</h3>
                    </div>
                    <div class="card-body">
                        <p th:text="${meta.descricao}">Descrição</p>

                        <div class="progress-section" style="background: var(--surface); padding: 0.5rem 0; margin-bottom: 1rem;">
                            <div class="progress-bar" style="background: var(--surface); height: 10px; border-radius: 8px; box-shadow: inset 0 2px 6px rgba(0,0,0,0.12);">
                                <div class="progress-fill" th:style="'width: ' + ${meta.progresso} + '%'" style="height: 100%;"></div>
                            </div>
                        </div>
                        
                        <!-- Para metas com prazo -->
                        <div th:if="${meta.tipo.name() == 'PRAZO'}">
                            <p><small th:text="'Prazo: ' + ${#temporals.format(meta.dataFim, 'dd/MM/yyyy')}">Prazo</small></p>
                            <p><small th:text="'Checkpoints: ' + ${meta.totalCheckpoints} + '/' + ${meta.duracaoDias}">Checkpoints</small></p>
                        </div>
                        
                        <!-- Para metas consecutivas -->
                        <div th:if="${meta.tipo.name() == 'CONSECUTIVO'}">
                            <p class="meta-consecutivo-info">
                                <small>Dias consecutivos: <span th:text="${meta.diasConsecutivos}">0</span>/<span th:text="${meta.duracaoDias}">10</span></small>
                            </p>
                            <p th:if="${meta.checkinPerdido}" class="meta-checkin-perdido">
                                <small><i class="fas fa-exclamation-circle"></i> Sequência perdida - Recomece hoje!</small>
                            </p>
                        </div>
                    </div>
                    <div class="card-footer meta-actions">
                        <!-- Botão de Check-in rápido -->
                        <form th:if="${meta.status.name() == 'ATIVA' and meta.podeRealizarCheckin}" 
                              th:action="@{/metas/{id}/progresso(id=${meta.id})}" 
                              method="post">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <button type="submit" class="btn btn-small btn-success">
                                <i class="fas fa-check"></i> <span th:text="#{metas.checkin}">Check-in</span>
                            </button>
                        </form>
                        
                        <span th:if="${meta.status.name() == 'ATIVA' and !meta.podeRealizarCheckin}" 
                              class="btn btn-small btn-disabled">
                            <i class="fas fa-check-circle"></i> <span th:text="#{metas.feitoHoje}">Feito hoje!</span>
                        </span>
                        
                        <a th:href="@{/metas/{id}(id=${meta.id})}" class="btn btn-small" style="flex: 1;" th:text="#{metas.verDetalhes}">Ver detalhes</a>
                    </div>
                </div>
            </div>
            
            <div th:if="${metas == null or metas.empty}" class="card">
                <p class="empty-state" th:text="#{metas.nenhumaMeta}">Nenhuma meta cadastrada</p>
            </div>
        </div>
    </main>

    <footer th:replace="~{fragments/footer :: footer}"></footer>
</body>
</html>
